!function(N,b,k,m){"use strict";if(N.ui&&N.ui.fancytree)N.ui.fancytree.warn("Fancytree: ignored duplicate include");else{var o,e,p=null,u=new RegExp(/\.|\//),t=/[&<>"'\/]/g,c="$recursive_request",n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},r={16:!0,17:!0,18:!0},s={8:"backspace",9:"tab",10:"return",13:"return",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},a={0:"",1:"left",2:"middle",3:"right"},y="active expanded focus folder hideCheckbox lazy selected unselectable".split(" "),v={},x="expanded extraClasses folder hideCheckbox icon key lazy refKey selected statusNodeType title tooltip unselectable".split(" "),l={},_={},d={active:!0,children:!0,data:!0,focus:!0};for(o=0;o<y.length;o++)v[y[o]]=!0;for(o=0;o<x.length;o++)e=x[o],l[e]=!0,e!==e.toLowerCase()&&(_[e.toLowerCase()]=e);C(N.ui,"Fancytree requires jQuery UI (http://jqueryui.com)"),A.prototype={_findDirectChild:function(e){var t,n,i=this.children;if(i)if("string"==typeof e){for(t=0,n=i.length;t<n;t++)if(i[t].key===e)return i[t]}else{if("number"==typeof e)return this.children[e];if(e.parent===this)return e}return null},_setChildren:function(e){C(e&&(!this.children||0===this.children.length),"only init supported"),this.children=[];for(var t=0,n=e.length;t<n;t++)this.children.push(new A(this,e[t]))},addChildren:function(e,t){var n,i,r,o,s=[];for(N.isPlainObject(e)&&(e=[e]),this.children||(this.children=[]),n=0,i=e.length;n<i;n++)s.push(new A(this,e[n]));return o=s[0],null==t?this.children=this.children.concat(s):(t=this._findDirectChild(t),C(0<=(r=N.inArray(t,this.children)),"insertBefore must be an existing child"),this.children.splice.apply(this.children,[r,0].concat(s))),(!this.parent||this.parent.ul||this.tr)&&this.render(),3===this.tree.options.selectMode&&this.fixSelection3FromEndNodes(),o},addClass:function(e){return this.toggleClass(e,!0)},addNode:function(e,t){switch(t!==m&&"over"!==t||(t="child"),t){case"after":return this.getParent().addChildren(e,this.getNextSibling());case"before":return this.getParent().addChildren(e,this);case"firstChild":var n=this.children?this.children[0]:null;return this.addChildren(e,n);case"child":case"over":return this.addChildren(e)}C(!1,"Invalid mode: "+t)},addPagingNode:function(e,t){var n,i;if(t=t||"child",!1!==e)return e=N.extend({title:this.tree.options.strings.moreData,statusNodeType:"paging",icon:!1},e),this.partload=!0,this.addNode(e,t);for(n=this.children.length-1;0<=n;n--)"paging"===(i=this.children[n]).statusNodeType&&this.removeChild(i);this.partload=!1},appendSibling:function(e){return this.addNode(e,"after")},applyPatch:function(e){if(null===e)return this.remove(),S(this);var t,n,i={children:!0,expanded:!0,parent:!0};for(t in e)n=e[t],i[t]||N.isFunction(n)||(l[t]?this[t]=n:this.data[t]=n);return e.hasOwnProperty("children")&&(this.removeChildren(),e.children&&this._setChildren(e.children)),this.isVisible()&&(this.renderTitle(),this.renderStatus()),e.hasOwnProperty("expanded")?this.setExpanded(e.expanded):S(this)},collapseSiblings:function(){return this.tree._callHook("nodeCollapseSiblings",this)},copyTo:function(e,t,n){return e.addNode(this.toDict(!0,n),t)},countChildren:function(e){var t,n,i,r=this.children;if(!r)return 0;if(i=r.length,!1!==e)for(t=0,n=i;t<n;t++)i+=r[t].countChildren();return i},debug:function(e){2<=this.tree.options.debugLevel&&(Array.prototype.unshift.call(arguments,this.toString()),i("log",arguments))},discard:function(){return this.warn("FancytreeNode.discard() is deprecated since 2014-02-16. Use .resetLazy() instead."),this.resetLazy()},discardMarkup:function(e){var t=e?"nodeRemoveMarkup":"nodeRemoveChildMarkup";this.tree._callHook(t,this)},findAll:function(t){t=N.isFunction(t)?t:L(t);var n=[];return this.visit(function(e){t(e)&&n.push(e)}),n},findFirst:function(t){t=N.isFunction(t)?t:L(t);var n=null;return this.visit(function(e){if(t(e))return n=e,!1}),n},_changeSelectStatusAttrs:function(e){var t=!1;switch(e){case!1:t=this.selected||this.partsel,this.selected=!1,this.partsel=!1;break;case!0:t=!this.selected||!this.partsel,this.selected=!0,this.partsel=!0;break;case m:t=this.selected||!this.partsel,this.selected=!1,this.partsel=!0;break;default:C(!1,"invalid state: "+e)}return t&&this.renderStatus(),t},fixSelection3AfterClick:function(){var t=this.isSelected();this.visit(function(e){e._changeSelectStatusAttrs(t)}),this.fixSelection3FromEndNodes()},fixSelection3FromEndNodes:function(){C(3===this.tree.options.selectMode,"expected selectMode 3"),function e(t){var n,i,r,o,s,a,l=t.children;if(l&&l.length){for(a=!(s=!0),n=0,i=l.length;n<i;n++)!1!==(r=e(l[n]))&&(a=!0),!0!==r&&(s=!1);o=!!s||!!a&&m}else o=!!t.selected;return t._changeSelectStatusAttrs(o),o}(this),this.visitParents(function(e){var t,n,i,r,o=e.children,s=!0,a=!1;for(t=0,n=o.length;t<n;t++)((i=o[t]).selected||i.partsel)&&(a=!0),i.unselectable||i.selected||(s=!1);r=!!s||!!a&&m,e._changeSelectStatusAttrs(r)})},fromDict:function(e){for(var t in e)l[t]?this[t]=e[t]:"data"===t?N.extend(this.data,e.data):N.isFunction(e[t])||d[t]||(this.data[t]=e[t]);e.children&&(this.removeChildren(),this.addChildren(e.children)),this.renderTitle()},getChildren:function(){return this.hasChildren()===m?m:this.children},getFirstChild:function(){return this.children?this.children[0]:null},getIndex:function(){return N.inArray(this,this.parent.children)},getIndexHier:function(e,n){e=e||".";var i,r=[];return N.each(this.getParentList(!1,!0),function(e,t){i=""+(t.getIndex()+1),n&&(i=("0000000"+i).substr(-n)),r.push(i)}),r.join(e)},getKeyPath:function(e){var t=[],n=this.tree.options.keyPathSeparator;return this.visitParents(function(e){e.parent&&t.unshift(e.key)},!e),n+t.join(n)},getLastChild:function(){return this.children?this.children[this.children.length-1]:null},getLevel:function(){for(var e=0,t=this.parent;t;)e++,t=t.parent;return e},getNextSibling:function(){if(this.parent){var e,t,n=this.parent.children;for(e=0,t=n.length-1;e<t;e++)if(n[e]===this)return n[e+1]}return null},getParent:function(){return this.parent},getParentList:function(e,t){for(var n=[],i=t?this:this.parent;i;)(e||i.parent)&&n.unshift(i),i=i.parent;return n},getPrevSibling:function(){if(this.parent){var e,t,n=this.parent.children;for(e=1,t=n.length;e<t;e++)if(n[e]===this)return n[e-1]}return null},getSelectedNodes:function(t){var n=[];return this.visit(function(e){if(e.selected&&(n.push(e),!0===t))return"skip"}),n},hasChildren:function(){return this.lazy?null==this.children?m:0!==this.children.length&&(1!==this.children.length||!this.children[0].isStatusNode()||m):!(!this.children||!this.children.length)},hasFocus:function(){return this.tree.hasFocus()&&this.tree.focusNode===this},info:function(e){1<=this.tree.options.debugLevel&&(Array.prototype.unshift.call(arguments,this.toString()),i("info",arguments))},isActive:function(){return this.tree.activeNode===this},isChildOf:function(e){return this.parent&&this.parent===e},isDescendantOf:function(e){if(!e||e.tree!==this.tree)return!1;for(var t=this.parent;t;){if(t===e)return!0;t=t.parent}return!1},isExpanded:function(){return!!this.expanded},isFirstSibling:function(){var e=this.parent;return!e||e.children[0]===this},isFolder:function(){return!!this.folder},isLastSibling:function(){var e=this.parent;return!e||e.children[e.children.length-1]===this},isLazy:function(){return!!this.lazy},isLoaded:function(){return!this.lazy||this.hasChildren()!==m},isLoading:function(){return!!this._isLoading},isRoot:function(){return this.isRootNode()},isPartload:function(){return!!this.partload},isRootNode:function(){return this.tree.rootNode===this},isSelected:function(){return!!this.selected},isStatusNode:function(){return!!this.statusNodeType},isPagingNode:function(){return"paging"===this.statusNodeType},isTopLevel:function(){return this.tree.rootNode===this.parent},isUndefined:function(){return this.hasChildren()===m},isVisible:function(){var e,t,n=this.getParentList(!1,!1);for(e=0,t=n.length;e<t;e++)if(!n[e].expanded)return!1;return!0},lazyLoad:function(e){return this.warn("FancytreeNode.lazyLoad() is deprecated since 2014-02-16. Use .load() instead."),this.load(e)},load:function(e){var t,n,i=this;return C(this.isLazy(),"load() requires a lazy node"),e||this.isUndefined()?(this.isLoaded()&&this.resetLazy(),!1===(n=this.tree._triggerNodeEvent("lazyLoad",this))?S(this):(C("boolean"!=typeof n,"lazyLoad event must return source in data.result"),t=this.tree._callHook("nodeLoadChildren",this,n),this.expanded&&t.always(function(){i.render()}),t)):S(this)},makeVisible:function(e){var t,n=this,i=[],r=new N.Deferred,o=this.getParentList(!1,!1),s=o.length,a=!(e&&!0===e.noAnimation),l=!(e&&!1===e.scrollIntoView);for(t=s-1;0<=t;t--)i.push(o[t].setExpanded(!0,e));return N.when.apply(N,i).done(function(){l?n.scrollIntoView(a).done(function(){r.resolve()}):r.resolve()}),r.promise()},moveTo:function(t,e,n){e===m||"over"===e?e="child":"firstChild"===e&&(t.children&&t.children.length?(e="before",t=t.children[0]):e="child");var i,r=this.parent,o="child"===e?t:t.parent;if(this!==t){if(this.parent?o.isDescendantOf(this)&&N.error("Cannot move a node to its own descendant"):N.error("Cannot move system root"),1===this.parent.children.length){if(this.parent===o)return;this.parent.children=this.parent.lazy?[]:null,this.parent.expanded=!1}else C(0<=(i=N.inArray(this,this.parent.children)),"invalid source parent"),this.parent.children.splice(i,1);if((this.parent=o).hasChildren())switch(e){case"child":o.children.push(this);break;case"before":C(0<=(i=N.inArray(t,o.children)),"invalid target parent"),o.children.splice(i,0,this);break;case"after":C(0<=(i=N.inArray(t,o.children)),"invalid target parent"),o.children.splice(i+1,0,this);break;default:N.error("Invalid mode "+e)}else o.children=[this];n&&t.visit(n,!0),this.tree!==t.tree&&(this.warn("Cross-tree moveTo is experimantal!"),this.visit(function(e){e.tree=t.tree},!0)),r.isDescendantOf(o)||r.render(),o.isDescendantOf(r)||o===r||o.render()}},navigate:function(t,n){var e,i,r,o=N.ui.keyCode,s=null;function a(e){if(e){try{e.makeVisible()}catch(e){}return N(e.span).is(":visible")?!1===n?e.setFocus():e.setActive():(e.debug("Navigate: skipping hidden node"),void e.navigate(t,n))}}switch(t){case o.BACKSPACE:this.parent&&this.parent.parent&&(r=a(this.parent));break;case o.LEFT:this.expanded?(this.setExpanded(!1),r=a(this)):this.parent&&this.parent.parent&&(r=a(this.parent));break;case o.RIGHT:this.expanded||!this.children&&!this.lazy?this.children&&this.children.length&&(r=a(this.children[0])):(this.setExpanded(),r=a(this));break;case o.UP:for(s=this.getPrevSibling();s&&!N(s.span).is(":visible");)s=s.getPrevSibling();for(;s&&s.expanded&&s.children&&s.children.length;)s=s.children[s.children.length-1];!s&&this.parent&&this.parent.parent&&(s=this.parent),r=a(s);break;case o.DOWN:if(this.expanded&&this.children&&this.children.length)s=this.children[0];else for(e=(i=this.getParentList(!1,!0)).length-1;0<=e;e--){for(s=i[e].getNextSibling();s&&!N(s.span).is(":visible");)s=s.getNextSibling();if(s)break}r=a(s);break;default:!1}return r||S()},remove:function(){return this.parent.removeChild(this)},removeChild:function(e){return this.tree._callHook("nodeRemoveChild",this,e)},removeChildren:function(){return this.tree._callHook("nodeRemoveChildren",this)},removeClass:function(e){return this.toggleClass(e,!1)},render:function(e,t){return this.tree._callHook("nodeRender",this,e,t)},renderTitle:function(){return this.tree._callHook("nodeRenderTitle",this)},renderStatus:function(){return this.tree._callHook("nodeRenderStatus",this)},replaceWith:function(e){var t,n=this.parent,i=N.inArray(this,n.children),r=this;return C(this.isPagingNode(),"replaceWith() currently requires a paging status node"),(t=this.tree._callHook("nodeLoadChildren",this,e)).done(function(e){var t=r.children;for(o=0;o<t.length;o++)t[o].parent=n;n.children.splice.apply(n.children,[i+1,0].concat(t)),r.children=null,r.remove(),n.render()}).fail(function(){r.setExpanded()}),t},resetLazy:function(){this.removeChildren(),this.expanded=!1,this.lazy=!0,this.children=m,this.renderStatus()},scheduleAction:function(e,t){this.tree.timer&&clearTimeout(this.tree.timer),this.tree.timer=null;var n=this;switch(e){case"cancel":break;case"expand":this.tree.timer=setTimeout(function(){n.tree.debug("setTimeout: trigger expand"),n.setExpanded(!0)},t);break;case"activate":this.tree.timer=setTimeout(function(){n.tree.debug("setTimeout: trigger activate"),n.setActive(!0)},t);break;default:N.error("Invalid mode "+e)}},scrollIntoView:function(e,t){var n;t!==m&&((n=t).tree&&n.statusNodeType!==m)&&(this.warn("scrollIntoView() with 'topNode' option is deprecated since 2014-05-08. Use 'options.topNode' instead."),t={topNode:t});var i,r,o,s=N.extend({effects:!0===e?{duration:200,queue:!1}:e,scrollOfs:this.tree.options.scrollOfs,scrollParent:this.tree.options.scrollParent||this.tree.$container,topNode:null},t),a=new N.Deferred,l=this,d=N(this.span).height(),c=N(s.scrollParent),h=s.scrollOfs.top||0,u=s.scrollOfs.bottom||0,f=c.height(),p=c.scrollTop(),g=c,y=c[0]===b,v=s.topNode||null,x=null;return N(this.span).is(":visible")?(y?(r=N(this.span).offset().top,i=v&&v.span?N(v.span).offset().top:0,g=N("html,body")):(C(c[0]!==k&&c[0]!==k.body,"scrollParent should be a simple element or `window`, not document or body."),o=c.offset().top,r=N(this.span).offset().top-o+p,i=v?N(v.span).offset().top-o+p:0,f-=Math.max(0,c.innerHeight()-c[0].clientHeight)),r<p+h?x=r-h:p+f-u<r+d&&(x=r+d-f+u,v&&(C(v.isRootNode()||N(v.span).is(":visible"),"topNode must be visible"),i<x&&(x=i-h))),null!==x?s.effects?(s.effects.complete=function(){a.resolveWith(l)},g.stop(!0).animate({scrollTop:x},s.effects)):(g[0].scrollTop=x,a.resolveWith(this)):a.resolveWith(this),a.promise()):(this.warn("scrollIntoView(): node is invisible."),S())},setActive:function(e,t){return this.tree._callHook("nodeSetActive",this,e,t)},setExpanded:function(e,t){return this.tree._callHook("nodeSetExpanded",this,e,t)},setFocus:function(e){return this.tree._callHook("nodeSetFocus",this,e)},setSelected:function(e){return this.tree._callHook("nodeSetSelected",this,e)},setStatus:function(e,t,n){return this.tree._callHook("nodeSetStatus",this,e,t,n)},setTitle:function(e){this.title=e,this.renderTitle()},sortChildren:function(e,t){var n,i,r=this.children;if(r){if(e=e||function(e,t){var n=e.title.toLowerCase(),i=t.title.toLowerCase();return n===i?0:i<n?1:-1},r.sort(e),t)for(n=0,i=r.length;n<i;n++)r[n].children&&r[n].sortChildren(e,"$norender$");"$norender$"!==t&&this.render()}},toDict:function(e,t){var n,i,r,o={},s=this;if(N.each(x,function(e,t){(s[t]||!1===s[t])&&(o[t]=s[t])}),N.isEmptyObject(this.data)||(o.data=N.extend({},this.data),N.isEmptyObject(o.data)&&delete o.data),t&&t(o,s),e&&this.hasChildren())for(o.children=[],n=0,i=this.children.length;n<i;n++)(r=this.children[n]).isStatusNode()||o.children.push(r.toDict(!0,t));return o},toggleClass:function(e,t){var n,i,r=e.match(/\S+/g)||[],o=0,s=!1,a=this[this.tree.statusClassPropName],l=" "+(this.extraClasses||"")+" ";for(a&&N(a).toggleClass(e,t);n=r[o++];)if(i=0<=l.indexOf(" "+n+" "),t=t===m?!i:!!t)i||(l+=n+" ",s=!0);else for(;-1<l.indexOf(" "+n+" ");)l=l.replace(" "+n+" "," ");return this.extraClasses=N.trim(l),s},toggleExpanded:function(){return this.tree._callHook("nodeToggleExpanded",this)},toggleSelected:function(){return this.tree._callHook("nodeToggleSelected",this)},toString:function(){return"<FancytreeNode(#"+this.key+", '"+this.title+"')>"},visit:function(e,t){var n,i,r=!0,o=this.children;if(!0===t&&(!1===(r=e(this))||"skip"===r))return r;if(o)for(n=0,i=o.length;n<i&&!1!==(r=o[n].visit(e,!0));n++);return r},visitAndLoad:function(n,e,t){var i,r,o,s=this;return!n||!0!==e||!1!==(r=n(s))&&"skip"!==r?s.children||s.lazy?(i=new N.Deferred,o=[],s.load().done(function(){for(var e=0,t=s.children.length;e<t;e++){if(!1===(r=s.children[e].visitAndLoad(n,!0,!0))){i.reject();break}"skip"!==r&&o.push(r)}N.when.apply(this,o).then(function(){i.resolve()})}),i.promise()):S():t?r:S()},visitParents:function(e,t){if(t&&!1===e(this))return!1;for(var n=this.parent;n;){if(!1===e(n))return!1;n=n.parent}return!0},warn:function(e){Array.prototype.unshift.call(arguments,this.toString()),i("warn",arguments)}},F.prototype={_makeHookContext:function(e,t,n){var i,r;return e.node!==m?(t&&e.originalEvent!==t&&N.error("invalid args"),i=e):e.tree?i={node:e,tree:r=e.tree,widget:r.widget,options:r.widget.options,originalEvent:t}:e.widget?i={node:null,tree:e,widget:e.widget,options:e.widget.options,originalEvent:t}:N.error("invalid args"),n&&N.extend(i,n),i},_callHook:function(e,t,n){var i=this._makeHookContext(t),r=this[e],o=Array.prototype.slice.call(arguments,2);return N.isFunction(r)||N.error("_callHook('"+e+"') is not a function"),o.unshift(i),r.apply(this,o)},_requireExtension:function(e,t,n,i){n=!!n;var r=this._local.name,o=this.options.extensions,s=N.inArray(e,o)<N.inArray(r,o),a=t&&null==this.ext[e],l=!a&&null!=n&&n!==s;return C(r&&r!==e,"invalid or same name"),!a&&!l||(i||(a||t?(i="'"+r+"' extension requires '"+e+"'",l&&(i+=" to be registered "+(n?"before":"after")+" itself")):i="If used together, `"+e+"` must be registered "+(n?"before":"after")+" `"+r+"`"),N.error(i),!1)},activateKey:function(e){var t=this.getNodeByKey(e);return t?t.setActive():this.activeNode&&this.activeNode.setActive(!1),t},addPagingNode:function(e,t){return this.rootNode.addPagingNode(e,t)},applyPatch:function(e){var t,n,i,r,o,s,a=e.length,l=[];for(n=0;n<a;n++)C(2===(i=e[n]).length,"patchList must be an array of length-2-arrays"),r=i[0],o=i[1],(s=null===r?this.rootNode:this.getNodeByKey(r))?(t=new N.Deferred,l.push(t),s.applyPatch(o).always(w(t,s))):this.warn("could not find node with key '"+r+"'");return N.when.apply(N,l).promise()},clear:function(e){this._callHook("treeClear",this)},count:function(){return this.rootNode.countChildren()},debug:function(e){2<=this.options.debugLevel&&(Array.prototype.unshift.call(arguments,this.toString()),i("log",arguments))},findAll:function(e){return this.rootNode.findAll(e)},findFirst:function(e){return this.rootNode.findFirst(e)},findNextNode:function(t,n,e){var i,r=null,o=n.parent.children,s=null,l=function(e,t,n){var i,r,o=e.children,s=o.length,a=o[t];if(a&&!1===n(a))return!1;if(a&&a.children&&a.expanded&&!1===l(a,0,n))return!1;for(i=t+1;i<s;i++)if(!1===l(e,i,n))return!1;return(r=e.parent)?l(r,r.children.indexOf(e)+1,n):l(e,0,n)};return t="string"==typeof t?(i=new RegExp("^"+t,"i"),function(e){return i.test(e.title)}):t,n=n||this.getFirstChild(),l(n.parent,o.indexOf(n),function(e){return e!==r&&(r=r||e,N(e.span).is(":visible")?(!t(e)||(s=e)===n)&&void 0:void e.debug("quicksearch: skipping hidden node"))}),s},generateFormElements:function(e,t,n){n=n||{};var i,r="string"==typeof e?e:"ft_"+this._id+"[]",o="string"==typeof t?t:"ft_"+this._id+"_active",s="fancytree_result_"+this._id,a=N("#"+s),l=3===this.options.selectMode&&!1!==n.stopOnParents;a.length?a.empty():a=N("<div>",{id:s}).hide().insertAfter(this.$container),!1!==e&&(i=this.getSelectedNodes(l),N.each(i,function(e,t){a.append(N("<input>",{type:"checkbox",name:r,value:t.key,checked:!0}))})),!1!==t&&this.activeNode&&a.append(N("<input>",{type:"radio",name:o,value:this.activeNode.key,checked:!0}))},getActiveNode:function(){return this.activeNode},getFirstChild:function(){return this.rootNode.getFirstChild()},getFocusNode:function(){return this.focusNode},getNodeByKey:function(t,e){var n,i;return!e&&(n=k.getElementById(this.options.idPrefix+t))?n.ftnode?n.ftnode:null:(e=e||this.rootNode,i=null,e.visit(function(e){if(e.key===t)return i=e,!1},!0),i)},getRootNode:function(){return this.rootNode},getSelectedNodes:function(e){return this.rootNode.getSelectedNodes(e)},hasFocus:function(){return!!this._hasFocus},info:function(e){1<=this.options.debugLevel&&(Array.prototype.unshift.call(arguments,this.toString()),i("info",arguments))},loadKeyPath:function(e,r,t){var n,i,o,s,a,l,d,c,h,u=this.options.keyPathSeparator,f=this;for(r=r||N.noop,N.isArray(e)||(e=[e]),l={},o=0;o<e.length;o++)for(c=t||this.rootNode,(s=e[o]).charAt(0)===u&&(s=s.substr(1)),h=s.split(u);h.length;){if(a=h.shift(),!(d=c._findDirectChild(a))){this.warn("loadKeyPath: key not found: "+a+" (parent: "+c+")"),r.call(this,a,"error");break}if(0===h.length){r.call(this,d,"ok");break}if(d.lazy&&d.hasChildren()===m){r.call(this,d,"loaded"),l[a]?l[a].push(h.join(u)):l[a]=[h.join(u)];break}r.call(this,d,"loaded"),c=d}function p(t,n,i){r.call(f,n,"loading"),n.load().done(function(){f.loadKeyPath.call(f,l[t],r,n).always(w(i,f))}).fail(function(e){f.warn("loadKeyPath: error loading: "+t+" (parent: "+c+")"),r.call(f,n,"error"),i.reject()})}for(a in n=[],l)d=c._findDirectChild(a),i=new N.Deferred,n.push(i),p(a,d,i);return N.when.apply(N,n).promise()},reactivate:function(e){var t,n=this.activeNode;return n?(this.activeNode=null,t=n.setActive(!0,{noFocus:!0}),e&&n.setFocus(),t):S()},reload:function(e){return this._callHook("treeClear",this),this._callHook("treeLoad",this,e)},render:function(e,t){return this.rootNode.render(e,t)},setFocus:function(e){return this._callHook("treeSetFocus",this,e)},toDict:function(e,t){var n=this.rootNode.toDict(!0,t);return e?n:n.children},toString:function(){return"<Fancytree(#"+this._id+")>"},_triggerNodeEvent:function(e,t,n,i){var r=this._makeHookContext(t,n,i),o=this.widget._trigger(e,n,r);return!1!==o&&r.result!==m?r.result:o},_triggerTreeEvent:function(e,t,n){var i=this._makeHookContext(this,t,n),r=this.widget._trigger(e,t,i);return!1!==r&&i.result!==m?i.result:r},visit:function(e){return this.rootNode.visit(e,!1)},warn:function(e){Array.prototype.unshift.call(arguments,this.toString()),i("warn",arguments)}},N.extend(F.prototype,{nodeClick:function(e){var t,n,i=e.targetType,r=e.node;if("expander"===i){if(r.isLoading())return void r.debug("Got 2nd click while loading: ignored");this._callHook("nodeToggleExpanded",e)}else if("checkbox"===i)this._callHook("nodeToggleSelected",e),e.options.focusOnSelect&&this._callHook("nodeSetFocus",e,!0);else{if(t=!(n=!1),r.folder)switch(e.options.clickFolderMode){case 2:t=!(n=!0);break;case 3:n=t=!0}t&&(this.nodeSetFocus(e),this._callHook("nodeSetActive",e,!0)),n&&this._callHook("nodeToggleExpanded",e)}},nodeCollapseSiblings:function(e,t){var n,i,r,o=e.node;if(o.parent)for(i=0,r=(n=o.parent.children).length;i<r;i++)n[i]!==o&&n[i].expanded&&this._callHook("nodeSetExpanded",n[i],!1,t)},nodeDblclick:function(e){"title"===e.targetType&&4===e.options.clickFolderMode&&this._callHook("nodeToggleExpanded",e),"title"===e.targetType&&e.originalEvent.preventDefault()},nodeKeydown:function(e){var t,n,i,r=e.originalEvent,o=e.node,s=e.tree,a=e.options,l=r.which,d=String.fromCharCode(l),c=!(r.altKey||r.ctrlKey||r.metaKey||r.shiftKey),h=N(r.target),u=!0,f=!(r.ctrlKey||!a.autoActivate);if(o||(i=this.getActiveNode()||this.getFirstChild())&&(i.setFocus(),(o=e.node=this.focusNode).debug("Keydown force focus on active node")),a.quicksearch&&c&&/\w/.test(d)&&!h.is(":input:enabled"))return 500<(n=(new Date).getTime())-s.lastQuicksearchTime&&(s.lastQuicksearchTerm=""),s.lastQuicksearchTime=n,s.lastQuicksearchTerm+=d,(t=s.findNextNode(s.lastQuicksearchTerm,s.getActiveNode()))&&t.setActive(),void r.preventDefault();switch(p.eventToString(r)){case"+":case"=":s.nodeSetExpanded(e,!0);break;case"-":s.nodeSetExpanded(e,!1);break;case"space":o.isPagingNode()?s._triggerNodeEvent("clickPaging",e,r):a.checkbox?s.nodeToggleSelected(e):s.nodeSetActive(e,!0);break;case"return":s.nodeSetActive(e,!0);break;case"backspace":case"left":case"right":case"up":case"down":o.navigate(r.which,f);break;default:u=!1}u&&r.preventDefault()},nodeLoadChildren:function(o,s){var t,n,e,a=o.tree,l=o.node,d=(new Date).getTime();return N.isFunction(s)&&(s=s.call(a,{type:"source"},o),C(!N.isFunction(s),"source callback must not return another function")),s.url&&(l._requestId&&l.warn("Recursive load request #"+d+" while #"+l._requestId+" is pending."),t=N.extend({},o.options.ajax,s),l._requestId=d,t.debugDelay?(n=t.debugDelay,N.isArray(n)&&(n=n[0]+Math.random()*(n[1]-n[0])),l.warn("nodeLoadChildren waiting debugDelay "+Math.round(n)+" ms ..."),t.debugDelay=!1,e=N.Deferred(function(e){setTimeout(function(){N.ajax(t).done(function(){e.resolveWith(this,arguments)}).fail(function(){e.rejectWith(this,arguments)})},n)})):e=N.ajax(t),s=new N.Deferred,e.done(function(e,t,n){var i,r;if("json"!==this.dataType&&"jsonp"!==this.dataType||"string"!=typeof e||N.error("Ajax request returned a string (did you get the JSON dataType wrong?)."),l._requestId&&l._requestId>d)s.rejectWith(this,[c]);else{if(o.options.postProcess){try{r=a._triggerNodeEvent("postProcess",o,o.originalEvent,{response:e,error:null,dataType:this.dataType})}catch(e){r={error:e,message:""+e,details:"postProcess failed"}}if(r.error)return i=N.isPlainObject(r.error)?r.error:{message:r.error},i=a._makeHookContext(l,null,i),void s.rejectWith(this,[i]);e=N.isArray(r)?r:e}else e&&e.hasOwnProperty("d")&&o.options.enableAspx&&(e="string"==typeof e.d?N.parseJSON(e.d):e.d);s.resolveWith(this,[e])}}).fail(function(e,t,n){var i=a._makeHookContext(l,null,{error:e,args:Array.prototype.slice.call(arguments),message:n,details:e.status+": "+n});s.rejectWith(this,[i])})),N.isFunction(s.then)&&N.isFunction(s.catch)&&(e=s,s=new N.Deferred,e.then(function(e){s.resolve(e)},function(e){s.reject(e)})),N.isFunction(s.promise)&&(a.nodeSetStatus(o,"loading"),s.done(function(e){a.nodeSetStatus(o,"ok"),l._requestId=null}).fail(function(e){var t;e!==c?(e.node&&e.error&&e.message?t=e:"[object Object]"===(t=a._makeHookContext(l,null,{error:e,args:Array.prototype.slice.call(arguments),message:e?e.message||e.toString():""})).message&&(t.message=""),l.warn("Load children failed ("+t.message+")",t),!1!==a._triggerNodeEvent("loadError",t,null)&&a.nodeSetStatus(o,"error",t.message,t.details)):l.warn("Ignored response for obsolete load request #"+d+" (expected #"+l._requestId+")")})),N.when(s).done(function(e){var t;N.isPlainObject(e)&&(C(l.isRootNode(),"source may only be an object for root nodes (expecting an array of child objects otherwise)"),C(N.isArray(e.children),"if an object is passed as source, it must contain a 'children' array (all other properties are added to 'tree.data')"),e=(t=e).children,delete t.children,N.extend(a.data,t)),C(N.isArray(e),"expected array of children"),l._setChildren(e),a._triggerNodeEvent("loadChildren",l)})},nodeLoadKeyPath:function(e,t){},nodeRemoveChild:function(e,t){var n,i=e.node,r=e.options,o=N.extend({},e,{node:t}),s=i.children;if(1===s.length)return C(t===s[0],"invalid single child"),this.nodeRemoveChildren(e);this.activeNode&&(t===this.activeNode||this.activeNode.isDescendantOf(t))&&this.activeNode.setActive(!1),this.focusNode&&(t===this.focusNode||this.focusNode.isDescendantOf(t))&&(this.focusNode=null),this.nodeRemoveMarkup(o),this.nodeRemoveChildren(o),C(0<=(n=N.inArray(t,s)),"invalid child"),t.visit(function(e){e.parent=null},!0),this._callHook("treeRegisterNode",this,!1,t),r.removeNode&&r.removeNode.call(e.tree,{type:"removeNode"},o),s.splice(n,1)},nodeRemoveChildMarkup:function(e){var t=e.node;t.ul&&(t.isRootNode()?N(t.ul).empty():(N(t.ul).remove(),t.ul=null),t.visit(function(e){e.li=e.ul=null}))},nodeRemoveChildren:function(t){var n,i=t.tree,e=t.node,r=e.children,o=t.options;r&&(this.activeNode&&this.activeNode.isDescendantOf(e)&&this.activeNode.setActive(!1),this.focusNode&&this.focusNode.isDescendantOf(e)&&(this.focusNode=null),this.nodeRemoveChildMarkup(t),n=N.extend({},t),e.visit(function(e){e.parent=null,i._callHook("treeRegisterNode",i,!1,e),o.removeNode&&(n.node=e,o.removeNode.call(t.tree,{type:"removeNode"},n))}),e.lazy?e.children=[]:e.children=null,e.isRootNode()||(e.expanded=!1),this.nodeRenderStatus(t))},nodeRemoveMarkup:function(e){var t=e.node;t.li&&(N(t.li).remove(),t.li=null),this.nodeRemoveChildMarkup(e)},nodeRender:function(e,t,n,i,r){var o,s,a,l,d,c,h,u=e.node,f=e.tree,p=e.options,g=p.aria,y=!1,v=u.parent,x=!v,b=u.children,m=null;if(x||v.ul){if(C(x||v.ul,"parent UL must exist"),x||(u.li&&(t||u.li.parentNode!==u.parent.ul)&&(u.li.parentNode===u.parent.ul?m=u.li.nextSibling:this.debug("Unlinking "+u+" (must be child of "+u.parent+")"),this.nodeRemoveMarkup(e)),u.li?this.nodeRenderStatus(e):(y=!0,u.li=k.createElement("li"),(u.li.ftnode=u).key&&p.generateIds&&(u.li.id=p.idPrefix+u.key),u.span=k.createElement("span"),u.span.className="fancytree-node",g&&N(u.span).attr("aria-labelledby","ftal_"+p.idPrefix+u.key),u.li.appendChild(u.span),this.nodeRenderTitle(e),p.createNode&&p.createNode.call(f,{type:"createNode"},e)),p.renderNode&&p.renderNode.call(f,{type:"renderNode"},e)),b){if(x||u.expanded||!0===n){for(u.ul||(u.ul=k.createElement("ul"),(!0!==i||r)&&u.expanded||(u.ul.style.display="none"),g&&N(u.ul).attr("role","group"),u.li?u.li.appendChild(u.ul):u.tree.$div.append(u.ul)),l=0,d=b.length;l<d;l++)h=N.extend({},e,{node:b[l]}),this.nodeRender(h,t,n,!1,!0);for(o=u.ul.firstChild;o;)(a=o.ftnode)&&a.parent!==u?(u.debug("_fixParent: remove missing "+a,o),c=o.nextSibling,o.parentNode.removeChild(o),o=c):o=o.nextSibling;for(o=u.ul.firstChild,l=0,d=b.length-1;l<d;l++)(s=b[l])!==(a=o.ftnode)?u.ul.insertBefore(s.li,a.li):o=o.nextSibling}}else u.ul&&(this.warn("remove child markup for "+u),this.nodeRemoveChildMarkup(e));x||y&&v.ul.insertBefore(u.li,m)}},nodeRenderTitle:function(e,t){var n,i,r,o,s=e.node,a=e.tree,l=e.options,d=l.aria,c=s.getLevel(),h=[];t!==m&&(s.title=t),s.span&&(c<l.minExpandLevel?(s.lazy||(s.expanded=!0),1<c&&(d?h.push("<span role='button' class='fancytree-expander fancytree-expander-fixed'></span>"):h.push("<span class='fancytree-expander fancytree-expander-fixed''></span>"))):d?h.push("<span role='button' class='fancytree-expander'></span>"):h.push("<span class='fancytree-expander'></span>"),l.checkbox&&!0!==s.hideCheckbox&&!s.isStatusNode()&&(d?h.push("<span role='checkbox' class='fancytree-checkbox'></span>"):h.push("<span class='fancytree-checkbox'></span>")),s.data.iconClass!==m&&(s.icon?N.error("'iconClass' node option is deprecated since v2.14.0: use 'icon' only instead"):(s.warn("'iconClass' node option is deprecated since v2.14.0: use 'icon' instead"),s.icon=s.data.iconClass)),N.isFunction(l.icon)?null==(n=l.icon.call(a,{type:"icon"},e))&&(n=s.icon):n=null!=s.icon?s.icon:l.icon,null==n?n=!0:"boolean"!=typeof n&&(n=""+n),!1!==n&&(r=d?" role='img'":"","string"==typeof n?u.test(n)?(n="/"===n.charAt(0)?n:(l.imagePath||"")+n,h.push("<img src='"+n+"' class='fancytree-icon' alt='' />")):h.push("<span "+r+" class='fancytree-custom-icon "+n+"'></span>"):h.push("<span "+r+" class='fancytree-icon'></span>")),i="",l.renderTitle&&(i=l.renderTitle.call(a,{type:"renderTitle"},e)||""),i||(o=s.tooltip?" title='"+T(s.tooltip)+"'":"",i="<span "+(r=d?" role='treeitem'":"")+" class='fancytree-title'"+(d?" id='ftal_"+l.idPrefix+s.key+"'":"")+o+(l.titlesTabbable?" tabindex='0'":"")+">"+(l.escapeTitles?T(s.title):s.title)+"</span>"),h.push(i),s.span.innerHTML=h.join(""),this.nodeRenderStatus(e),l.enhanceTitle&&(e.$title=N(">span.fancytree-title",s.span),i=l.enhanceTitle.call(a,{type:"enhanceTitle"},e)||""))},nodeRenderStatus:function(e){var t=e.node,n=e.tree,i=e.options,r=t.hasChildren(),o=t.isLastSibling(),s=i.aria,a=N(t.span).find(".fancytree-title"),l=i._classNames,d=[],c=t[n.statusClassPropName];c&&(d.push(l.node),n.activeNode===t&&d.push(l.active),n.focusNode===t?(d.push(l.focused),s&&a.attr("aria-activedescendant",!0)):s&&a.removeAttr("aria-activedescendant"),t.expanded?(d.push(l.expanded),s&&a.attr("aria-expanded",!0)):s&&a.removeAttr("aria-expanded"),t.folder&&d.push(l.folder),!1!==r&&d.push(l.hasChildren),o&&d.push(l.lastsib),t.lazy&&null==t.children&&d.push(l.lazy),t.partload&&d.push(l.partload),t.partsel&&d.push(l.partsel),t.unselectable&&d.push(l.unselectable),t._isLoading&&d.push(l.loading),t._error&&d.push(l.error),t.statusNodeType&&d.push(l.statusNodePrefix+t.statusNodeType),t.selected?(d.push(l.selected),s&&a.attr("aria-selected",!0)):s&&a.attr("aria-selected",!1),t.extraClasses&&d.push(t.extraClasses),!1===r?d.push(l.combinedExpanderPrefix+"n"+(o?"l":"")):d.push(l.combinedExpanderPrefix+(t.expanded?"e":"c")+(t.lazy&&null==t.children?"d":"")+(o?"l":"")),d.push(l.combinedIconPrefix+(t.expanded?"e":"c")+(t.folder?"f":"")),c.className=d.join(" "),t.li&&(t.li.className=o?l.lastsib:""))},nodeSetActive:function(e,t,n){n=n||{};var i,r=e.node,o=e.tree,s=e.options,a=!0===n.noEvents,l=!0===n.noFocus;return r===o.activeNode===(t=!1!==t)?S(r):t&&!a&&!1===this._triggerNodeEvent("beforeActivate",r,e.originalEvent)?g(r,["rejected"]):(t?(o.activeNode&&(C(o.activeNode!==r,"node was active (inconsistency)"),i=N.extend({},e,{node:o.activeNode}),o.nodeSetActive(i,!1),C(null===o.activeNode,"deactivate was out of sync?")),s.activeVisible&&r.makeVisible({scrollIntoView:!1}),o.activeNode=r,o.nodeRenderStatus(e),l||o.nodeSetFocus(e),a||o._triggerNodeEvent("activate",r,e.originalEvent)):(C(o.activeNode===r,"node was not active (inconsistency)"),o.activeNode=null,this.nodeRenderStatus(e),a||e.tree._triggerNodeEvent("deactivate",r,e.originalEvent)),S(r))},nodeSetExpanded:function(n,i,e){e=e||{};var t,r,o,s,a,l,d=n.node,c=n.tree,h=n.options,u=!0===e.noAnimation,f=!0===e.noEvents;if(i=!1!==i,d.expanded&&i||!d.expanded&&!i)return S(d);if(i&&!d.lazy&&!d.hasChildren())return S(d);if(!i&&d.getLevel()<h.minExpandLevel)return g(d,["locked"]);if(!f&&!1===this._triggerNodeEvent("beforeExpand",d,n.originalEvent))return g(d,["rejected"]);if(u||d.isVisible()||(u=e.noAnimation=!0),r=new N.Deferred,i&&!d.expanded&&h.autoCollapse){a=d.getParentList(!1,!0),l=h.autoCollapse;try{for(h.autoCollapse=!1,o=0,s=a.length;o<s;o++)this._callHook("nodeCollapseSiblings",a[o],e)}finally{h.autoCollapse=l}}return r.done(function(){var e=d.getLastChild();i&&h.autoScroll&&!u&&e?e.scrollIntoView(!0,{topNode:d}).always(function(){f||n.tree._triggerNodeEvent(i?"expand":"collapse",n)}):f||n.tree._triggerNodeEvent(i?"expand":"collapse",n)}),t=function(e){var t=h.toggleEffect;if(d.expanded=i,c._callHook("nodeRender",n,!1,!1,!0),d.ul)if("none"!==d.ul.style.display===!!d.expanded)d.warn("nodeSetExpanded: UL.style.display already set");else{if(t&&!u)return void N(d.ul).toggle(t.effect,t.options,t.duration,function(){e()});d.ul.style.display=d.expanded||!parent?"":"none"}e()},i&&d.lazy&&d.hasChildren()===m?d.load().done(function(){r.notifyWith&&r.notifyWith(d,["loaded"]),t(function(){r.resolveWith(d)})}).fail(function(e){t(function(){r.rejectWith(d,["load failed ("+e+")"])})}):t(function(){r.resolveWith(d)}),r.promise()},nodeSetFocus:function(e,t){var n,i=e.tree,r=e.node;if(t=!1!==t,i.focusNode){if(i.focusNode===r&&t)return;n=N.extend({},e,{node:i.focusNode}),i.focusNode=null,this._triggerNodeEvent("blur",n),this._callHook("nodeRenderStatus",n)}t&&(this.hasFocus()||(r.debug("nodeSetFocus: forcing container focus"),this._callHook("treeSetFocus",e,!0,{calledByNode:!0})),r.makeVisible({scrollIntoView:!1}),i.focusNode=r,i.options.titlesTabbable?N(r.span).find(".fancytree-title").focus():0===N(k.activeElement).closest(".fancytree-container").length&&N(i.$container).focus(),this._triggerNodeEvent("focus",e),e.options.autoScroll&&r.scrollIntoView(),this._callHook("nodeRenderStatus",e))},nodeSetSelected:function(e,t){var n=e.node,i=e.tree,r=e.options;if(t=!1!==t,n.debug("nodeSetSelected("+t+")",e),!n.unselectable){if(n.selected&&t||!n.selected&&!t)return!!n.selected;if(!1===this._triggerNodeEvent("beforeSelect",n,e.originalEvent))return!!n.selected;t&&1===r.selectMode?i.lastSelectedNode&&i.lastSelectedNode.setSelected(!1):3===r.selectMode&&(n.selected=t,n.fixSelection3AfterClick()),n.selected=t,this.nodeRenderStatus(e),i.lastSelectedNode=t?n:null,i._triggerNodeEvent("select",e)}},nodeSetStatus:function(e,t,n,i){var r=e.node,o=e.tree;function s(e,t){var n=r.children?r.children[0]:null;return n&&n.isStatusNode()?(N.extend(n,e),n.statusNodeType=t,o._callHook("nodeRenderTitle",n)):(r._setChildren([e]),r.children[0].statusNodeType=t,o.render()),r.children[0]}switch(t){case"ok":!function(){var e=r.children?r.children[0]:null;if(e&&e.isStatusNode()){try{r.ul&&(r.ul.removeChild(e.li),e.li=null)}catch(e){}1===r.children.length?r.children=[]:r.children.shift()}}(),r._isLoading=!1,r._error=null,r.renderStatus();break;case"loading":r.parent||s({title:o.options.strings.loading+(n?" ("+n+")":""),checkbox:!1,tooltip:i},t),r._isLoading=!0,r._error=null,r.renderStatus();break;case"error":s({title:o.options.strings.loadError+(n?" ("+n+")":""),checkbox:!1,tooltip:i},t),r._isLoading=!1,r._error={message:n,details:i},r.renderStatus();break;case"nodata":s({title:o.options.strings.noData,checkbox:!1,tooltip:i},t),r._isLoading=!1,r._error=null,r.renderStatus();break;default:N.error("invalid node status "+t)}},nodeToggleExpanded:function(e){return this.nodeSetExpanded(e,!e.node.expanded)},nodeToggleSelected:function(e){return this.nodeSetSelected(e,!e.node.selected)},treeClear:function(e){var t=e.tree;t.activeNode=null,t.focusNode=null,t.$div.find(">ul.fancytree-container").empty(),t.rootNode.children=null},treeCreate:function(e){},treeDestroy:function(e){this.$div.find(">ul.fancytree-container").remove(),this.$source&&this.$source.removeClass("ui-helper-hidden")},treeInit:function(e){this.treeLoad(e)},treeLoad:function(e,t){var n,i,r=e.tree,o=e.widget.element,s=N.extend({},e,{node:this.rootNode});if(r.rootNode.children&&this.treeClear(e),t=t||this.options.source)"string"==typeof t&&N.error("Not implemented");else switch(n=o.data("type")||"html"){case"html":(i=o.find(">ul:first")).addClass("ui-fancytree-source ui-helper-hidden"),t=N.ui.fancytree.parseHtml(i),this.data=N.extend(this.data,E(i));break;case"json":(t=N.parseJSON(o.text())).children&&(t.title&&(r.title=t.title),t=t.children);break;default:N.error("Invalid data-type: "+n)}return this.nodeLoadChildren(s,t).done(function(){r.render(),3===e.options.selectMode&&r.rootNode.fixSelection3FromEndNodes(),r.activeNode&&r.options.activeVisible&&r.activeNode.makeVisible(),r._triggerTreeEvent("init",null,{status:!0})}).fail(function(){r.render(),r._triggerTreeEvent("init",null,{status:!1})})},treeRegisterNode:function(e,t,n){},treeSetFocus:function(e,t,n){(t=!1!==t)!==this.hasFocus()&&(!(this._hasFocus=t)&&this.focusNode?this.focusNode.setFocus(!1):!t||n&&n.calledByNode||N(this.$container).focus(),this.$container.toggleClass("fancytree-treefocus",t),this._triggerTreeEvent(t?"focusTree":"blurTree"))}}),N.widget("ui.fancytree",{options:{activeVisible:!0,ajax:{type:"GET",cache:!1,dataType:"json"},aria:!1,autoActivate:!0,autoCollapse:!1,autoScroll:!1,checkbox:!1,clickFolderMode:4,debugLevel:null,disabled:!1,enableAspx:!0,escapeTitles:!1,extensions:[],toggleEffect:{effect:"blind",options:{direction:"vertical",scale:"box"},duration:200},generateIds:!1,icon:!0,idPrefix:"ft_",focusOnSelect:!1,keyboard:!0,keyPathSeparator:"/",minExpandLevel:1,quicksearch:!1,scrollOfs:{top:0,bottom:0},scrollParent:null,selectMode:2,strings:{loading:"Loading&#8230;",loadError:"Load error!",moreData:"More&#8230;",noData:"No data."},tabindex:"0",titlesTabbable:!1,_classNames:{node:"fancytree-node",folder:"fancytree-folder",combinedExpanderPrefix:"fancytree-exp-",combinedIconPrefix:"fancytree-ico-",hasChildren:"fancytree-has-children",active:"fancytree-active",selected:"fancytree-selected",expanded:"fancytree-expanded",lazy:"fancytree-lazy",focused:"fancytree-focused",partload:"fancytree-partload",partsel:"fancytree-partsel",unselectable:"fancytree-unselectable",lastsib:"fancytree-lastsib",loading:"fancytree-loading",error:"fancytree-error",statusNodePrefix:"fancytree-statusnode-"},lazyLoad:null,postProcess:null},_create:function(){this.tree=new F(this),this.$source=this.source||"json"===this.element.data("type")?this.element:this.element.find(">ul:first");var e,t,n,i=this.options,r=i.extensions;this.tree;for(n=0;n<r.length;n++)t=r[n],(e=N.ui.fancytree._extensions[t])||N.error("Could not apply extension '"+t+"' (it is not registered, did you forget to include it?)"),this.tree.options[t]=N.extend(!0,{},e.options,this.tree.options[t]),C(this.tree.ext[t]===m,"Extension name must not exist as Fancytree.ext attribute: '"+t+"'"),this.tree.ext[t]={},f(this.tree,0,e,t),e;i.icons!==m&&(!0!==i.icon?N.error("'icons' tree option is deprecated since v2.14.0: use 'icon' only instead"):(this.tree.warn("'icons' tree option is deprecated since v2.14.0: use 'icon' instead"),i.icon=i.icons)),i.iconClass!==m&&(i.icon?N.error("'iconClass' tree option is deprecated since v2.14.0: use 'icon' only instead"):(this.tree.warn("'iconClass' tree option is deprecated since v2.14.0: use 'icon' instead"),i.icon=i.iconClass)),i.tabbable!==m&&(i.tabindex=i.tabbable?"0":"-1",this.tree.warn("'tabbable' tree option is deprecated since v2.17.0: use 'tabindex='"+i.tabindex+"' instead")),this.tree._callHook("treeCreate",this.tree)},_init:function(){this.tree._callHook("treeInit",this.tree),this._bind()},_setOption:function(e,t){var n=!0,i=!1;switch(e){case"aria":case"checkbox":case"icon":case"minExpandLevel":case"tabindex":this.tree._callHook("treeCreate",this.tree),i=!0;break;case"escapeTitles":i=!0;break;case"source":n=!1,this.tree._callHook("treeLoad",this.tree,t)}this.tree.debug("set option "+e+"="+t+" <"+typeof t+">"),n&&N.Widget.prototype._setOption.apply(this,arguments),i&&this.tree.render(!0,!1)},destroy:function(){this._unbind(),this.tree._callHook("treeDestroy",this.tree),N.Widget.prototype.destroy.call(this)},_unbind:function(){var e=this.tree._ns;this.element.unbind(e),this.tree.$container.unbind(e),N(k).unbind(e)},_bind:function(){var s=this,a=this.options,o=this.tree,e=o._ns;this._unbind(),o.$container.on("focusin"+e+" focusout"+e,function(e){var t=p.getNode(e),n="focusin"===e.type;t?o._callHook("nodeSetFocus",t,n):o._callHook("treeSetFocus",o,n)}).on("selectstart"+e,"span.fancytree-title",function(e){e.preventDefault()}).on("keydown"+e,function(e){if(a.disabled||!1===a.keyboard)return!0;var t,n=o.focusNode,i=o._makeHookContext(n||o,e),r=o.phase;try{return o.phase="userEvent","preventNav"===(t=n?o._triggerNodeEvent("keydown",n,e):o._triggerTreeEvent("keydown",e))?t=!0:!1!==t&&(t=o._callHook("nodeKeydown",i)),t}finally{o.phase=r}}).on("click"+e+" dblclick"+e,function(e){if(a.disabled)return!0;var t,n=p.getEventTarget(e),i=n.node,r=s.tree,o=r.phase;if(!i)return!0;t=r._makeHookContext(i,e);try{switch(r.phase="userEvent",e.type){case"click":return t.targetType=n.type,i.isPagingNode()?!0===r._triggerNodeEvent("clickPaging",t,e):!1!==r._triggerNodeEvent("click",t,e)&&r._callHook("nodeClick",t);case"dblclick":return t.targetType=n.type,!1!==r._triggerNodeEvent("dblclick",t,e)&&r._callHook("nodeDblclick",t)}}finally{r.phase=o}})},getActiveNode:function(){return this.tree.activeNode},getNodeByKey:function(e){return this.tree.getNodeByKey(e)},getRootNode:function(){return this.tree.rootNode},getTree:function(){return this.tree}}),p=N.ui.fancytree,N.extend(N.ui.fancytree,{version:"2.18.0",buildType:"production",debugLevel:1,_nextId:1,_nextNodeKey:1,_extensions:{},_FancytreeClass:F,_FancytreeNodeClass:A,jquerySupports:{positionMyOfs:function(e,t,n,i){var r,o,s,a=N.map(N.trim(e).split("."),function(e){return parseInt(e,10)}),l=N.map(Array.prototype.slice.call(arguments,1),function(e){return parseInt(e,10)});for(r=0;r<l.length;r++)if((o=a[r]||0)!==(s=l[r]||0))return s<o;return!0}(N.ui.version,1,9)},assert:function(e,t){return C(e,t)},debounce:function(t,n,i,r){var o;return 3===arguments.length&&"boolean"!=typeof i&&(r=i,i=!1),function(){var e=arguments;r=r||this,i&&!o&&n.apply(r,e),clearTimeout(o),o=setTimeout(function(){i||n.apply(r,e),o=null},t)}},debug:function(e){2<=N.ui.fancytree.debugLevel&&i("log",arguments)},error:function(e){i("error",arguments)},escapeHtml:T,fixPositionOptions:function(e){if((e.offset||0<=(""+e.my+e.at).indexOf("%"))&&N.error("expected new position syntax (but '%' is not supported)"),!N.ui.fancytree.jquerySupports.positionMyOfs){var t=/(\w+)([+-]?\d+)?\s+(\w+)([+-]?\d+)?/.exec(e.my),n=/(\w+)([+-]?\d+)?\s+(\w+)([+-]?\d+)?/.exec(e.at),i=(t[2]?+t[2]:0)+(n[2]?+n[2]:0),r=(t[4]?+t[4]:0)+(n[4]?+n[4]:0);e=N.extend({},e,{my:t[1]+" "+t[3],at:n[1]+" "+n[3]}),(i||r)&&(e.offset=i+" "+r)}return e},getEventTargetType:function(e){return this.getEventTarget(e).type},getEventTarget:function(e){var t=e&&e.target?e.target.className:"",n={node:this.getNode(e.target),type:m};return/\bfancytree-title\b/.test(t)?n.type="title":/\bfancytree-expander\b/.test(t)?n.type=!1===n.node.hasChildren()?"prefix":"expander":/\bfancytree-checkbox\b/.test(t)||/\bfancytree-radio\b/.test(t)?n.type="checkbox":/\bfancytree-icon\b/.test(t)?n.type="icon":/\bfancytree-node\b/.test(t)?n.type="title":e&&e.target&&N(e.target).closest(".fancytree-title").length&&(n.type="title"),n},getNode:function(e){if(e instanceof A)return e;for(e.selector!==m?e=e[0]:e.originalEvent!==m&&(e=e.target);e;){if(e.ftnode)return e.ftnode;e=e.parentNode}return null},getTree:function(e){var t;return e instanceof F?e:(e===m&&(e=0),"number"==typeof e?e=N(".fancytree-container").eq(e):"string"==typeof e?e=N(e).eq(0):e.selector!==m?e=e.eq(0):e.originalEvent!==m&&(e=N(e.target)),(t=(e=e.closest(":ui-fancytree")).data("ui-fancytree")||e.data("fancytree"))?t.tree:null)},info:function(e){1<=N.ui.fancytree.debugLevel&&i("info",arguments)},eventToString:function(e){var t=e.which,n=e.type,i=[];return e.altKey&&i.push("alt"),e.ctrlKey&&i.push("ctrl"),e.metaKey&&i.push("meta"),e.shiftKey&&i.push("shift"),"click"===n||"dblclick"===n?i.push(a[e.button]+n):r[t]||i.push(s[t]||String.fromCharCode(t).toLowerCase()),i.join("+")},keyEventToString:function(e){return this.warn("keyEventToString() is deprecated: use eventToString()"),this.eventToString(e)},parseHtml:function(s){var a,l,d,c,h,u,f,p,e=s.find(">li"),g=[];return e.each(function(){var e,t,n=N(this),i=n.find(">span:first",this),r=i.length?null:n.find(">a:first"),o={tooltip:null,data:{}};for(i.length?o.title=i.html():r&&r.length?(o.title=r.html(),o.data.href=r.attr("href"),o.data.target=r.attr("target"),o.tooltip=r.attr("title")):(o.title=n.html(),0<=(h=o.title.search(/<ul/i))&&(o.title=o.title.substring(0,h))),o.title=N.trim(o.title),c=0,u=y.length;c<u;c++)o[y[c]]=m;for(a=this.className.split(" "),d=[],c=0,u=a.length;c<u;c++)l=a[c],v[l]?o[l]=!0:d.push(l);if(o.extraClasses=d.join(" "),(f=n.attr("title"))&&(o.tooltip=f),(f=n.attr("id"))&&(o.key=f),(e=E(n))&&!N.isEmptyObject(e)){for(t in _)e.hasOwnProperty(t)&&(e[_[t]]=e[t],delete e[t]);for(c=0,u=x.length;c<u;c++)f=x[c],null!=(p=e[f])&&(delete e[f],o[f]=p);N.extend(o.data,e)}(s=n.find(">ul:first")).length?o.children=N.ui.fancytree.parseHtml(s):o.children=o.lazy?m:null,g.push(o)}),g},registerExtension:function(e){C(null!=e.name,"extensions must have a `name` property."),C(null!=e.version,"extensions must have a `version` property."),N.ui.fancytree._extensions[e.name]=e},unescapeHtml:function(e){var t=k.createElement("div");return t.innerHTML=e,0===t.childNodes.length?"":t.childNodes[0].nodeValue},warn:function(e){i("warn",arguments)}})}function C(e,t){e||(t=t?": "+t:"",N.error("Fancytree assertion failed"+t))}function i(e,t){var n,i,r=b.console?b.console[e]:null;if(r)try{r.apply(b.console,t)}catch(e){for(i="",n=0;n<t.length;n++)i+=t[n];r(i)}}function h(e,i,t,n,r){var o,s,a,l,d;return o=i[e],s=n[e],a=i.ext[r],l=function(){return o.apply(i,arguments)},d=function(e){return o.apply(i,e)},function(){var e=i._local,t=i._super,n=i._superApply;try{return i._local=a,i._super=l,i._superApply=d,s.apply(i,arguments)}finally{i._local=e,i._super=t,i._superApply=n}}}function f(e,t,n,i){for(var r in n)"function"==typeof n[r]?"function"==typeof e[r]?e[r]=h(r,e,0,n,i):"_"===r.charAt(0)?e.ext[i][r]=h(r,e,0,n,i):N.error("Could not override tree."+r+". Use prefix '_' to create tree."+i+"._"+r):"options"!==r&&(e.ext[i][r]=n[r])}function S(e,t){return e===m?N.Deferred(function(){this.resolve()}).promise():N.Deferred(function(){this.resolveWith(e,t)}).promise()}function g(e,t){return e===m?N.Deferred(function(){this.reject()}).promise():N.Deferred(function(){this.rejectWith(e,t)}).promise()}function w(e,t){return function(){e.resolveWith(t)}}function E(e){var t=N.extend({},e.data()),n=t.json;return delete t.fancytree,delete t.uiFancytree,n&&(delete t.json,t=N.extend(t,n)),t}function T(e){return(""+e).replace(t,function(e){return n[e]})}function L(t){return t=t.toLowerCase(),function(e){return 0<=e.title.toLowerCase().indexOf(t)}}function A(e,t){var n,i,r,o;for(this.parent=e,this.tree=e.tree,this.ul=null,this.li=null,this.statusNodeType=null,this._isLoading=!1,this._error=null,this.data={},n=0,i=x.length;n<i;n++)this[r=x[n]]=t[r];for(r in t.data&&N.extend(this.data,t.data),t)l[r]||N.isFunction(t[r])||d[r]||(this.data[r]=t[r]);null==this.key?this.tree.options.defaultKey?(this.key=this.tree.options.defaultKey(this),C(this.key,"defaultKey() must return a unique key")):this.key="_"+p._nextNodeKey++:this.key=""+this.key,t.active&&(C(null===this.tree.activeNode,"only one active node allowed"),this.tree.activeNode=this),t.selected&&(this.tree.lastSelectedNode=this),(o=t.children)?o.length?this._setChildren(o):this.children=this.lazy?[]:null:this.children=null,this.tree._callHook("treeRegisterNode",this.tree,!0,this)}function F(e){this.widget=e,this.$div=e.element,this.options=e.options,this.options&&(N.isFunction(this.options.lazyload)&&!N.isFunction(this.options.lazyLoad)&&(this.options.lazyLoad=function(){return p.warn("The 'lazyload' event is deprecated since 2014-02-25. Use 'lazyLoad' (with uppercase L) instead."),e.options.lazyload.apply(this,arguments)}),N.isFunction(this.options.loaderror)&&N.error("The 'loaderror' event was renamed since 2014-07-03. Use 'loadError' (with uppercase E) instead."),this.options.fx!==m&&p.warn("The 'fx' options was replaced by 'toggleEffect' since 2014-11-30.")),this.ext={},this.data=E(this.$div),this._id=N.ui.fancytree._nextId++,this._ns=".fancytree-"+this._id,this.activeNode=null,this.focusNode=null,this._hasFocus=null,this.lastSelectedNode=null,this.systemFocusElement=null,this.lastQuicksearchTerm="",this.lastQuicksearchTime=0,this.statusClassPropName="span",this.ariaPropName="li",this.nodeContainerAttrName="li",this.$div.find(">ul.fancytree-container").remove();var t,n={tree:this};this.rootNode=new A(n,{title:"root",key:"root_"+this._id,children:null,expanded:!0}),this.rootNode.parent=null,t=N("<ul>",{class:"ui-fancytree fancytree-container fancytree-plain"}).appendTo(this.$div),this.$container=t,this.rootNode.ul=t[0],null==this.options.debugLevel&&(this.options.debugLevel=p.debugLevel),this.$container.attr("tabindex",this.options.tabindex),this.options.aria&&this.$container.attr("role","tree").attr("aria-multiselectable",!0)}}(jQuery,window,document),function(l,e,t,n){"use strict";function d(e,t){return e.map[t]}l.ui.fancytree.registerExtension({name:"glyph",version:"0.4.0",options:{map:{checkbox:"icon-check-empty",checkboxSelected:"icon-check",checkboxUnknown:"icon-check icon-muted",error:"icon-exclamation-sign",expanderClosed:"icon-caret-right",expanderLazy:"icon-angle-right",expanderOpen:"icon-caret-down",nodata:"icon-meh",noExpander:"",dragHelper:"icon-caret-right",dropMarker:"icon-caret-right",doc:"icon-file-alt",docOpen:"icon-file-alt",loading:"icon-refresh icon-spin",folder:"icon-folder-close-alt",folderOpen:"icon-folder-open-alt"}},treeInit:function(e){var t=e.tree;this._superApply(arguments),t.$container.addClass("fancytree-ext-glyph")},nodeRenderStatus:function(e){var t,n,i,r=e.node,o=l(r.span),s=e.options.glyph,a=s.map;return n=this._superApply(arguments),r.isRoot()||((i=o.children("span.fancytree-expander").get(0))&&(t=r.expanded?"expanderOpen":r.isUndefined()?"expanderLazy":r.hasChildren()?"expanderClosed":"noExpander",i.className="fancytree-expander "+a[t]),(i=r.tr?l("td",r.tr).find("span.fancytree-checkbox").get(0):o.children("span.fancytree-checkbox").get(0))&&(t=r.selected?"checkboxSelected":r.partsel?"checkboxUnknown":"checkbox",i.className="fancytree-checkbox "+a[t]),(i=o.children("span.fancytree-icon").get(0))&&(t=r.statusNodeType?d(s,r.statusNodeType):r.folder?r.expanded?d(s,"folderOpen"):d(s,"folder"):r.expanded?d(s,"docOpen"):d(s,"doc"),i.className="fancytree-icon "+t)),n},nodeSetStatus:function(e,t,n,i){var r,o=e.options.glyph,s=e.node;return r=this._superApply(arguments),"error"!==t&&"loading"!==t&&"nodata"!==t||(s.parent?l("span.fancytree-expander",s.span).get(0).className="fancytree-expander "+d(o,t):l(".fancytree-statusnode-"+t,s[this.nodeContainerAttrName]).find("span.fancytree-icon").get(0).className="fancytree-icon "+d(o,t)),r}})}(jQuery,window,document);